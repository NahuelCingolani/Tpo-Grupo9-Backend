{
  "info": {
    "name": "Ecommerce API Full Tests (DTO fixed)",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "base_url", "value": "http://localhost:8080" },
    { "key": "token", "value": "" },
    { "key": "token_admin", "value": "" },
    { "key": "usuario_id", "value": "" },
    { "key": "producto_id", "value": "" }
  ],
  "item": [
    {
      "name": "Auth - Registrar usuario",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"nombre\": \"Test\",\n  \"apellido\": \"User\",\n  \"email\": \"testuser@correo.com\",\n  \"password\": \"12345678\",\n  \"role\": \"USER\"\n}"
        },
        "url": { "raw": "{{base_url}}/api/auth/register", "host": ["{{base_url}}"], "path": ["api", "auth", "register"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "var json = pm.response.json();",
            "pm.expect(json).to.have.property('token');",
            "pm.environment.set('token', json.token);"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Auth - Login usuario",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"testuser@correo.com\",\n  \"password\": \"12345678\"\n}"
        },
        "url": { "raw": "{{base_url}}/api/auth/login", "host": ["{{base_url}}"], "path": ["api", "auth", "login"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "var json = pm.response.json();",
            "pm.expect(json).to.have.property('token');",
            "pm.environment.set('token', json.token);"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Auth - Login admin",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"admin@correo.com\",\n  \"password\": \"admin123\"\n}"
        },
        "url": { "raw": "{{base_url}}/api/auth/login", "host": ["{{base_url}}"], "path": ["api", "auth", "login"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "var json = pm.response.json();",
            "pm.expect(json).to.have.property('token');",
            "pm.environment.set('token_admin', json.token);"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Usuarios - Listar todos",
      "request": {
        "method": "GET",
        "header": [{ "key": "Authorization", "value": "Bearer {{token_admin}}" }],
        "url": { "raw": "{{base_url}}/usuarios", "host": ["{{base_url}}"], "path": ["usuarios"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "var data = pm.response.json();",
            "pm.expect(data).to.be.an('array');"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Usuarios - Crear",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token_admin}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"nombre\": \"Nuevo\",\n  \"apellido\": \"Admin\",\n  \"email\": \"nuevoadmin@correo.com\",\n  \"password\": \"123456\",\n  \"role\": \"ADMIN\"\n}"
        },
        "url": { "raw": "{{base_url}}/usuarios", "host": ["{{base_url}}"], "path": ["usuarios"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "var json = pm.response.json();",
            "pm.environment.set('usuario_id', json.id);"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Usuarios - Obtener por ID",
      "request": {
        "method": "GET",
        "header": [{ "key": "Authorization", "value": "Bearer {{token_admin}}" }],
        "url": { "raw": "{{base_url}}/usuarios/{{usuario_id}}", "host": ["{{base_url}}"], "path": ["usuarios", "{{usuario_id}}"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "var json = pm.response.json();",
            "pm.expect(json).to.have.property('id', pm.environment.get('usuario_id'));"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Usuarios - Actualizar",
      "request": {
        "method": "PUT",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token_admin}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"nombre\": \"Editado\",\n  \"apellido\": \"Admin\",\n  \"email\": \"editadoadmin@correo.com\",\n  \"password\": \"654321\",\n  \"role\": \"ADMIN\"\n}"
        },
        "url": { "raw": "{{base_url}}/usuarios/{{usuario_id}}", "host": ["{{base_url}}"], "path": ["usuarios", "{{usuario_id}}"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "var json = pm.response.json();",
            "pm.expect(json).to.have.property('nombre','Editado');"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Usuarios - Eliminar",
      "request": {
        "method": "DELETE",
        "header": [{ "key": "Authorization", "value": "Bearer {{token_admin}}" }],
        "url": { "raw": "{{base_url}}/usuarios/{{usuario_id}}", "host": ["{{base_url}}"], "path": ["usuarios", "{{usuario_id}}"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200 (o 204)\", () => pm.expect([200,204]).to.include(pm.response.code));"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Productos - Listar todos",
      "request": {
        "method": "GET",
        "header": [],
        "url": { "raw": "{{base_url}}/api/productos", "host": ["{{base_url}}"], "path": ["api", "productos"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "var data = pm.response.json();",
            "pm.expect(data).to.be.an('array');"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Productos - Crear",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token_admin}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"nombre\": \"Producto Test\",\n  \"descripcion\": \"Desc prueba\",\n  \"precio\": 1000,\n  \"equipo\": \"Lakers\",\n  \"jugador\": \"LeBron James\",\n  \"categoria\": \"Camisetas\",\n  \"stockPorTalle\": {\"M\": 10, \"L\": 5}\n}"
        },
        "url": { "raw": "{{base_url}}/api/productos", "host": ["{{base_url}}"], "path": ["api", "productos"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "pm.environment.set('producto_id', pm.response.json().id);"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Productos - Obtener por ID",
      "request": {
        "method": "GET",
        "header": [],
        "url": { "raw": "{{base_url}}/api/productos/{{producto_id}}", "host": ["{{base_url}}"], "path": ["api", "productos", "{{producto_id}}"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "pm.expect(pm.response.json()).to.have.property('id', pm.environment.get('producto_id'));"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Productos - Actualizar",
      "request": {
        "method": "PUT",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token_admin}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"nombre\": \"Producto Modificado\",\n  \"descripcion\": \"Desc editada\",\n  \"precio\": 2000,\n  \"equipo\": \"Lakers\",\n  \"jugador\": \"LeBron James\",\n  \"categoria\": \"Camisetas\",\n  \"stockPorTalle\": {\"M\": 5, \"L\": 2}\n}"
        },
        "url": { "raw": "{{base_url}}/api/productos/{{producto_id}}", "host": ["{{base_url}}"], "path": ["api", "productos", "{{producto_id}}"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "pm.expect(pm.response.json()).to.have.property('nombre', 'Producto Modificado');"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Productos - Actualización parcial (PATCH)",
      "request": {
        "method": "PATCH",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token_admin}}" },
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{ \"precio\": 7777 }"
        },
        "url": { "raw": "{{base_url}}/api/productos/{{producto_id}}", "host": ["{{base_url}}"], "path": ["api", "productos", "{{producto_id}}"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "pm.expect(pm.response.json()).to.have.property('precio', 7777);"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Productos - Eliminar",
      "request": {
        "method": "DELETE",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token_admin}}" }
        ],
        "url": { "raw": "{{base_url}}/api/productos/{{producto_id}}", "host": ["{{base_url}}"], "path": ["api", "productos", "{{producto_id}}"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "pm.expect(pm.response.text()).to.include('eliminado');"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Productos - Importar mock",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token_admin}}" }
        ],
        "url": { "raw": "{{base_url}}/api/productos/importarMock", "host": ["{{base_url}}"], "path": ["api", "productos", "importarMock"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "pm.expect(pm.response.text()).to.match(/[0-9]+ productos nuevos agregados/);"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Productos - Eliminar todos",
      "request": {
        "method": "DELETE",
        "header": [
          { "key": "Authorization", "value": "Bearer {{token_admin}}" }
        ],
        "url": { "raw": "{{base_url}}/api/productos/eliminarTodos", "host": ["{{base_url}}"], "path": ["api", "productos", "eliminarTodos"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "pm.expect(pm.response.text()).to.include('eliminados');"
          ],
          "type": "text/javascript"
        }
      }]
    },
    {
      "name": "Productos - Buscar por equipo",
      "request": {
        "method": "GET",
        "header": [],
        "url": { "raw": "{{base_url}}/api/productos/equipo/Lakers", "host": ["{{base_url}}"], "path": ["api", "productos", "equipo", "Lakers"] }
      },
      "event": [{
        "listen": "test",
        "script": {
          "exec": [
            "pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
            "pm.expect(pm.response.json()).to.be.an('array');"
          ],
          "type": "text/javascript"
        }
      }]
    }
  ]
}